# Telegram Bot с ИИ на Python

## Стек технологий

### Основные технологии:
- Python 3.9+
- aiogram 3.x (асинхронный фреймворк для Telegram Bot API)
- OpenAI API (для обработки сообщений)
- SQLite (для хранения данных пользователей)
- aiohttp (для асинхронных HTTP-запросов)

### Библиотеки:
- `aiogram` - работа с Telegram Bot API
- `openai` - интеграция с OpenAI API
- `sqlite3` - работа с базой данных
- `python-dotenv` - управление переменными окружения
- `aiohttp` - асинхронные HTTP-запросы
- `logging` - логирование работы бота

## Техническое задание

### 1. Общие требования
- Разработка асинхронного чат-бота для Telegram на Python
- Интеграция с OpenAI для обработки сообщений
- Обеспечение минималистичного и дружелюбного взаимодействия с пользователями
- Асинхронная обработка сообщений

### 2. Функциональные требования

#### 2.1. Входящие сообщения
- Обработка текстовых сообщений через Telegram Bot API
- Поддержка команд:
  - `/start` - приветственное сообщение
  - `/help` - справка по использованию
- Обработка callback-запросов от inline-кнопок

#### 2.2. Обработка сообщений
- Интеграция с OpenAI API для генерации ответов
- Настройка системного сообщения для определения поведения бота:
  - Дружелюбный тон общения
  - Краткие и информативные ответы
  - Остановка на первом упомянутом шаге
  - Замена эмодзи ":sparks:" на "✨"
- Кэширование ответов для оптимизации
- Обработка ошибок API

#### 2.3. Отправка ответов
- Асинхронная отправка ответов пользователям
- Поддержка форматирования Markdown
- Обработка длинных сообщений (разбиение на части)
- Индикатор набора сообщения (typing status)

### 3. Технические требования
- Асинхронная архитектура приложения
- Использование паттерна FSM (Finite State Machine)
- Логирование всех действий бота
- Хранение конфигурации в .env файле
- База данных для хранения:
  - Статистики использования
  - Настроек пользователей
  - Кэша ответов

### 4. Требования к безопасности
- Безопасное хранение токенов в .env файле
- Валидация входящих данных
- Ограничение частоты запросов к API
- Защита от спама и злоупотреблений

### 5. Требования к производительности
- Асинхронная обработка запросов
- Кэширование частых ответов
- Оптимизация запросов к API
- Обработка до 1000 сообщений в минуту

### 6. Этапы разработки
1. Настройка окружения разработки
2. Создание базовой структуры бота
3. Реализация обработки команд
4. Интеграция с OpenAI API
5. Настройка базы данных
6. Реализация кэширования
7. Добавление логирования
8. Тестирование функциональности
9. Оптимизация производительности
10. Развертывание на сервере

### 7. Структура проекта
```
telegram_bot/
├── bot/
│   ├── __init__.py
│   ├── main.py           # Точка входа
│   ├── config.py         # Конфигурация
│   ├── handlers/         # Обработчики сообщений
│   ├── keyboards/        # Клавиатуры
│   ├── middlewares/      # Промежуточное ПО
│   ├── services/         # Сервисы (OpenAI, кэш)
│   └── database/         # Работа с БД
├── .env                  # Переменные окружения
├── requirements.txt      # Зависимости
└── README.md            # Документация
```

### 8. Требования к коду
- Соблюдение PEP 8
- Типизация кода (type hints)
- Документирование функций и классов
- Модульные тесты
- Логирование важных событий
